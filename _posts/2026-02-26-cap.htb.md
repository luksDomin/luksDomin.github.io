---
layout: post
title: Cap
date: 2026-02-09 +0100
tags:
  - IDOR
os: Linux
level: Easy
image: https://htb-mp-prod-public-storage.s3.eu-central-1.amazonaws.com/avatars/70ea3357a2d090af11a0953ec8717e90.png
---
## Enumeración inicial

En primer lugar realizamos un escaneo con **Nmap** para identificar que puertos están abiertos con:

```bash
nmap -p- --open -Pn -n -T5 -sSV 10.129.2.117
```

Resultado:
```
PORT   STATE SERVICE VERSION
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
```

Ahora exploraremos las versiones de los servicios:

```bash
nmap -p- --open -Pn -n -T5 -sCV 10.129.2.117
```

```
Starting Nmap 7.95 ( https://nmap.org ) at 2026-02-09 17:57 WET
Nmap scan report for 10.129.2.117
Host is up (0.15s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    Gunicorn
|_http-server-header: gunicorn
|_http-title: Security Dashboard
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```

## Análisis del servicio web

Al acceder al puerto 80 encontramos un Security Dashboard:

![[dashboard.png]]
Navegando por la aplicación podremos ver que parece ejecutar comandos del sistema mostrando su salida en las diferentes secciones. Si vamos a  `Security Snapshot (5 Second PCAP + Analysis)` veremos que la página tarda 5 segundos y muestra una interfaz con diferentes estadísticas de capturas de paquetes que nos deja descargar como .pcap:

![[capture1.png]]

Si generamos tráfico con:
```bash
sudo hping -S -p 80 --fast 10.129.2.117
```
 
 y  volvemos a acceder a la sección de captura observamos dos cosas, que cambian las estadísticas y que la URL incluye un identificador incremental (`/data/1`, `/data/2`, etc.). Este comportamiento sugiere que cada captura se almacena con un identificador numérico.
 
![[capture2.png]]

### IDOR

Si modificamos manualmente el identificador en la URL, por ejemplo: `/data/0` observamos nuevos datos que nosotros no hemos generado.  Esto indica la presencia de un IDOR (Insecure Direct Object Reference) :

![[idor.png]]

### PCAP

Descargamos el archivo y lo abrimos en wireshark. Dado que la máquina tiene un servicio FTP el cual no cifra las comunicaciones, filtramos por protocolo FTP y encontramos las siguientes credenciales:

![[wireshark.png]]

## Acceso por FTP

Accediendo a la máquina por FTP con las anteriores credenciales encontramos la user flag:

![[user-txt.png]]

## Escalada de privilegios

Para escalar privilegios nos conectaremos por ssh con las mismas credenciales y revisamos que capacidades tienen los diferentes archivos con  `getcap`:

![[capabilities.png]]

Encontramos que python tiene cap_setuid lo cual permite a un proceso cambiar su UID arbitrariamente, incluso a 0 (root). Si ejecutamos python podremos elevar privilegios y consultar la root flag:

![[root-txt.png]]